{% extends "base.html" %}

{% block title %}Quiz{% endblock %}
{{ redirect_to_login_immediately }}

{% block body %}
<div class="container mt-5 mb-5">
  <h1 class="text-center">All The Best!</h1><br>
  <div class="text-center mb-4" style="font-size: 1.5rem;">
    Timer:
    <span id="timer"></span>
  </div>
  <form id="quiz-form" method="post" action="{% url 'quiz' %}">
    {% csrf_token %}
    {% for q in questions %}
    <div class="card border-primary mb-4 mx-auto" style="width: 800px;">
      <div class="card-header">
        Question <span class="question-number">{{ forloop.counter }}</span>
      </div>
      <div class="card-body">
        <h5 class="user-select-none">{{ q.question }}</h5>
        <input type="hidden" name="q{{ forloop.counter }}" value="{{ q.id }}">
        <div class="custom-control custom-radio">
          <input class="custom-control-input" type="radio" name="q{{ forloop.counter }}o" id="q{{ forloop.counter }}o1" value="A">
          <label class="custom-control-label" for="q{{ forloop.counter }}o1">{{ q.option1 }}</label>
        </div>
        <div class="custom-control custom-radio">
          <input class="custom-control-input" type="radio" name="q{{ forloop.counter }}o" id="q{{ forloop.counter }}o2" value="B">
          <label class="custom-control-label" for="q{{ forloop.counter }}o2">{{ q.option2 }}</label>
        </div>
        <div class="custom-control custom-radio">
          <input class="custom-control-input" type="radio" name="q{{ forloop.counter }}o" id="q{{ forloop.counter }}o3" value="C">
          <label class="custom-control-label" for="q{{ forloop.counter }}o3">{{ q.option3 }}</label>
        </div>
        <div class="custom-control custom-radio">
          <input class="custom-control-input" type="radio" name="q{{ forloop.counter }}o" id="q{{ forloop.counter }}o4" value="D">
          <label class="custom-control-label" for="q{{ forloop.counter }}o4">{{ q.option4 }}</label>
        </div>
      </div>
    </div>
    {% endfor %}
    <div class="mb-3 form-check mx-auto" style="width: 800px;">
      <input type="checkbox" class="form-check-input" id="exampleCheck1" required>
      <label class="form-check-label" for="exampleCheck1">Yes, I am sure</label><br><br>
      <center><button id="submit-btn" type="submit" class="btn btn-custom mx-auto">Submit Quiz</button></center>
    </div>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Timer variables
  let startTime;
  const duration = 2 * 60 * 1000; // 5 minutes in milliseconds

  // Start the timer function
  function startTimer() {
    startTime = new Date().getTime() + duration; // Set start time as current time + duration
    updateTimer(); // Update timer immediately when starting
    setTimeout(function() {
      document.getElementById('quiz-form').submit(); // Automatically submit the form after duration
      document.getElementById('submit-btn').setAttribute('disabled', 'disabled'); // Disable submit button after form submission
    }, duration);
  }

  // Update timer display function
  function updateTimer() {
    let now = new Date().getTime(); // Current time in milliseconds
    let timeLeft = startTime - now; // Time left in milliseconds

    if (timeLeft >= 0) {
      let seconds = Math.floor((timeLeft / 1000) % 60); // Calculate remaining seconds
      let minutes = Math.floor((timeLeft / (1000 * 60)) % 60); // Calculate remaining minutes

      // Display timer in format MM:SS
      document.getElementById('timer').innerText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

      // Update timer every second
      setTimeout(updateTimer, 1000);
    }
  }

  // Start timer when the page loads
  startTimer();
});
</script>
{% endblock %}
